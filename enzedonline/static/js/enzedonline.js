let convertUTCDateToLocalDate=t=>{local_date=new Date(t.getTime()+6e4*t.getTimezoneOffset());return local_date.toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"long",day:"numeric"})+" "+local_date.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1})};$(document).ready((function(){$('a[href^="http://"]').attr("target","_blank"),$('a[href^="http://"]').attr("rel","nofollow noopener"),$('a[href^="https://"]').attr("target","_blank"),$('a[href^="https://"]').attr("rel","nofollow noopener")})),$(document).ready((function(){fa_icons=document.getElementsByTagName("fa");for(let t=0;t<fa_icons.length;t++){const e=fa_icons[t].innerText;fa_icons[t].innerText="";fa_icons[t].appendChild(document.createElement("i")).className=e}}));let draw_mapblock=t=>{const e=JSON.parse(document.getElementById(`${t}`).textContent);add_mapbox(e)},add_mapbox=t=>{mapboxgl.accessToken=t.token;const e=new mapboxgl.Map({container:`map-${t.uid}`,style:"mapbox://styles/mapbox/outdoors-v11"});e.addControl(new mapboxgl.NavigationControl),e.addControl(new mapboxgl.ScaleControl({position:"bottom-right"}));const o=(t,e)=>t.map((t=>t[e])),a=Math.min(...o(t.waypoints,"latitude")),n=Math.max(...o(t.waypoints,"latitude")),i=Math.min(...o(t.waypoints,"longitude")),d=Math.max(...o(t.waypoints,"longitude"));e.fitBounds([[i,a],[d,n]],{padding:{top:t.padding[0],right:t.padding[1],bottom:t.padding[2],left:t.padding[3]}}),e.on("load",(()=>{if("no-route"!=t.method){!async function(o){let a=[];for(let t=0;t<o.length;t++)a.push([o[t].longitude,o[t].latitude].join());let n=a.join(";");const i=await fetch(`https://api.mapbox.com/directions/v5/mapbox/${t.route_type}/${n}?steps=false&geometries=geojson&access_token=${mapboxgl.accessToken}`,{method:"GET"}),d=(await i.json()).routes[0],r=d.geometry.coordinates,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:r}};e.addLayer({id:`route-${t.uid}`,type:"line",source:{type:"geojson",data:l},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3887be","line-width":5,"line-opacity":.75}}),t.show_route_info&&(document.getElementById(`distance-${t.uid}`).innerText=(Math.round(d.distance/100)/10).toFixed(1),document.getElementById(`hours-${t.uid}`).innerText=(Math.round(d.duration/360)/10).toFixed(1),document.getElementById(`routesummary-${t.uid}`).style.display="block");const p=new mapboxgl.LngLatBounds(r[0],r[0]);for(const t of r)p.extend(t);e.fitBounds(p,{padding:{top:t.padding[0],right:t.padding[1],bottom:t.padding[2],left:t.padding[3]}})}(t.waypoints),e.addLayer({id:"start",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[t.waypoints[0].longitude,t.waypoints[0].latitude]}}]}},paint:{"circle-radius":10,"circle-color":"#3887be"}});let o=t.waypoints.length-1;e.addLayer({id:"end",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[t.waypoints[o].longitude,t.waypoints[o].latitude]}}]}},paint:{"circle-radius":10,"circle-color":"#f30"}})}t.waypoints.forEach((function(t){if(t.show_pin){(new mapboxgl.Marker).setLngLat([t.longitude,t.latitude]).setPopup((new mapboxgl.Popup).setHTML("<b>"+t.pin_label+"</b><br/>"+`<a href="https://www.google.com/maps?q=${t.latitude},${t.longitude}" \n                       target="_blank">${t.latitude}, ${t.longitude}</a>`)).addTo(e)}}))}))};