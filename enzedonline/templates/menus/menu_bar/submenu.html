{% load wagtailimages_tags menu_tags %}
{% get_menu menu as sub_menu %}
{% if sub_menu %}
    {% get_menu_items sub_menu request as sub_menu_items %}
    {% if sub_menu_items %}
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle"
               data-bs-toggle="dropdown"
               role="button"
               aria-haspopup="true"
               aria-expanded="false">
                {% if item.display_option != "text" and sub_menu.icon %}
                    {% image sub_menu.icon fill-25x25 class="image-menu" %}
                {% endif %}
                {% if item.display_option != "icon" %}{{ sub_menu.title }}{% endif %}
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
                {% for subitem in sub_menu_items %}
                    {% if not subitem.is_submenu %}
                        <li>
                            <a class="dropdown-item{% if request.path == subitem.url %} active{% endif %}"
                               href="{{ subitem.url }}">
                                {% if subitem.icon %}
                                    {% image subitem.icon fill-25x25 class="image-menu" %}
                                {% endif %}
                                {{ subitem.title|truncatewords:6 }}
                            </a>
                        </li>
                    {% else %}
                        {% include "menus/menu_bar/horizontal_submenu.html" with menu=subitem.submenu_id %}
                    {% endif %}
                    {% if subitem.divider %}<div class="dropdown-divider"></div>{% endif %}
                {% endfor %}
            </ul>
        </li>
    {% endif %}
{% endif %}
