{% load static core_tags comments comments_xtd socialaccount userauth_login %}
{% get_template_set "comments" as trans %}
{% get_comment_count for page as comment_count %}
{% get_login_form as login_form %}
<div class="container-fluid pt-3 px-2 px-sm-5 pb-1">
  <div class="card">
    <div class="comments-header bg-info" id="comments">{{ trans.comments }}</div>
    <div class="ps-4 card-body">
      {# Show Comments #}
      {% if comment_count %}
        {% render_xtdcomment_tree for page allow_feedback show_feedback %}
      {% endif %}
      {# Show Comment if Signed In, Show Login Invite If Not #}
      {% if request.user.is_authenticated %}
        <div class="mt-3">{% render_comment_form for page %}</div>
      {% else %}
        {# login existing users #}
        <div class="h5 py-2">
          <a href="{% url 'account_login' %}?next={{ request.path }}{{ '%23comments'|safe }}" rel="nofollow">{{ trans.sign_in }}</a> {{ trans.to_comment }}
        </div>
        {# Social Connections #}
        {% get_providers as socialaccount_providers %}
        {% if socialaccount_providers %}
          <p class="h5">{{ trans.connect_with_social }}</p>
          <div class="pb-2">
            {% for provider in socialaccount_providers %}
              <a title="{{ provider.name }}"
                 class="text-decoration-none"
                 href="{% provider_login_url provider.id process='login' next=request.path|add:'#comments'|safe scope=scope auth_params=auth_params %}"
                 rel="nofollow">
                <svg class="oauth-icon me-3" title="{{ provider.name }}">
                  <use href="#icon-{{ provider.name|lower }}" />
                </svg>
              </a>
            {% endfor %}
          </div>
        {% endif %}
        {# Invite to Sign Up #}
        <p class="h5">
          <a href="{% url 'account_signup' %}?next={{ request.path }}{{ '%23comments'|safe }}" rel="nofollow">{{ trans.sign_up }}</a> {{ trans.with_email }}
        </p>
      {% endif %}
    </div>
  </div>
</div>
