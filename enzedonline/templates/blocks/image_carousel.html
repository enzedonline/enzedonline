{% load wagtailimages_tags wagtailcore_tags core_tags %}

<div class="block-container">
    {% if self.heading %}
        <div class="carousel-title">
            {{ self.heading }}
        </div>    
    {% endif %}
    <div id="slideshow" class="carousel slide carousel-fade" data-bs-ride="carousel">
        <div class="carousel-inner">
            {% for slide in self.carousel_images %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    {% if self.format == '4-1' %}
                        {% image slide.value.image.file fill-2100x525-c100 format-webp as webp_img_w_2100 %} 
                        {% image slide.value.image.file fill-1500x375-c100 format-webp as webp_img_w_1500 %} 
                        {% image slide.value.image.file fill-900x225-c100 format-webp as webp_img_w_900 %} 
                        {% image slide.value.image.file fill-600x150-c100 format-webp as webp_img_w_600 %}
                        {% image slide.value.image.file fill-300x75-c100 format-webp as webp_img_w_300 %}
                        {% image slide.value.image.file fill-148x37-c100 format-webp as webp_img_w_150 %}
                        {% image slide.value.image.file fill-2100x525-c100 as fallback %} 
                    {% elif self.format == '3-1' %}
                        {% image slide.value.image.file fill-2100x700-c100 format-webp as webp_img_w_2100 %} 
                        {% image slide.value.image.file fill-1500x500-c100 format-webp as webp_img_w_1500 %} 
                        {% image slide.value.image.file fill-900x300-c100 format-webp as webp_img_w_900 %} 
                        {% image slide.value.image.file fill-600x200-c100 format-webp as webp_img_w_600 %}
                        {% image slide.value.image.file fill-300x100-c100 format-webp as webp_img_w_300 %}
                        {% image slide.value.image.file fill-150x50-c100 format-webp as webp_img_w_150 %}
                        {% image slide.value.image.file fill-2100x700-c100 as fallback %} 
                    {% elif self.format == '4-3' %}
                        {% image slide.value.image.file fill-2100x1400-c100 format-webp as webp_img_w_2100 %} 
                        {% image slide.value.image.file fill-1500x1000-c100 format-webp as webp_img_w_1500 %} 
                        {% image slide.value.image.file fill-900x600-c100 format-webp as webp_img_w_900 %} 
                        {% image slide.value.image.file fill-600x400-c100 format-webp as webp_img_w_600 %}
                        {% image slide.value.image.file fill-300x225-c100 format-webp as webp_img_w_300 %}
                        {% image slide.value.image.file fill-148x111-c100 format-webp as webp_img_w_150 %}
                        {% image slide.value.image.file fill-2100x1400-c100 as fallback %} 
                    {% elif self.format == '1-1' %}
                        {% image slide.value.image.file fill-2100x2100-c100 format-webp as webp_img_w_2100 %} 
                        {% image slide.value.image.file fill-1500x1500-c100 format-webp as webp_img_w_1500 %} 
                        {% image slide.value.image.file fill-900x900-c100 format-webp as webp_img_w_900 %} 
                        {% image slide.value.image.file fill-600x600-c100 format-webp as webp_img_w_600 %}
                        {% image slide.value.image.file fill-300x300-c100 format-webp as webp_img_w_300 %}
                        {% image slide.value.image.file fill-150x150-c100 format-webp as webp_img_w_150 %}
                        {% image slide.value.image.file fill-2100x2100-c100 as fallback %} 
                    {% elif self.format == '3-4' %}
                        {% image slide.value.image.file fill-2100x2800-c100 format-webp as webp_img_w_2100 %} 
                        {% image slide.value.image.file fill-1500x2000-c100 format-webp as webp_img_w_1500 %} 
                        {% image slide.value.image.file fill-900x1200-c100 format-webp as webp_img_w_900 %} 
                        {% image slide.value.image.file fill-600x800-c100 format-webp as webp_img_w_600 %}
                        {% image slide.value.image.file fill-300x400-c100 format-webp as webp_img_w_300 %}
                        {% image slide.value.image.file fill-150x200-c100 format-webp as webp_img_w_150 %}
                        {% image slide.value.image.file fill-1500x2000-c100 as fallback %} 
                    {% elif self.format == '1-3' %}
                        {% image slide.value.image.file fill-2100x6300-c100 format-webp as webp_img_w_2100 %} 
                        {% image slide.value.image.file fill-1500x4500-c100 format-webp as webp_img_w_1500 %} 
                        {% image slide.value.image.file fill-900x2700-c100 format-webp as webp_img_w_900 %} 
                        {% image slide.value.image.file fill-600x1800-c100 format-webp as webp_img_w_600 %}
                        {% image slide.value.image.file fill-300x900-c100 format-webp as webp_img_w_300 %}
                        {% image slide.value.image.file fill-150x450-c100 format-webp as webp_img_w_150 %}
                        {% image slide.value.image.file fill-600x1800-c100 as fallback %} 
                    {% endif %}
                        
                    <picture>
                        <source media="(min-width: 1501px)" srcset="{{ webp_img_w_2100.url }} 2100w" type="image/webp" />
                        <source media="(min-width: 901px)" srcset="{{ webp_img_w_1500.url }} 1500w" type="image/webp" />
                        <source media="(min-width: 601px)" srcset="{{ webp_img_w_900.url }} 900w" type="image/webp" />
                        <source media="(min-width: 301px)" srcset="{{ webp_img_w_600.url }} 600w" type="image/webp" />
                        <source media="(min-width: 151px)" srcset="{{ webp_img_w_300.url }} 300w" type="image/webp" />
                        <source srcset="{{ webp_img_w_150.url }} 150w" type="image/webp" />
                        <source srcset="{{ fallback.url }}" />
                        <img
                            class="d-block w-100"
                            src="{{ fallback.url }}"
                            alt="{{ slide.value.image.seo_title }}"
                            style="width: 100%; height: auto"
                        />
                    </picture>
                    {% if slide.value.title or slide.value.caption %}
                        <div class="carousel-caption">
                            {% if slide.value.title %}
                                <div class="carousel-caption-title">
                                    {{ slide.value.title }}
                                </div>
                            {% endif %}
                            {% if slide.value.caption %}
                                <div class="p carousel-caption-caption">
                                    {{ slide.value.caption }}
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                    {% if slide.value.link %}
                        <a href="{% trans_url slide.value.link %}" class="stretched-link"></a>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        {% if show_scroll_buttons %}
            <a class="carousel-control-prev" href="#slideshow" role="button" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#slideshow" role="button" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        {% endif %}
    </div>
</div>
