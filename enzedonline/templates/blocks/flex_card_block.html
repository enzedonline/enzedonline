{% load wagtailimages_tags wagtailcore_tags flex_card_tags %}
{% image self.image.file fill-2100x1470-c100 format-webp as webp_img_w_2100 %} 
{% image self.image.file fill-1500x1050-c100 format-webp as webp_img_w_1500 %} 
{% image self.image.file fill-900x630-c100 format-webp as webp_img_w_900 %} 
{% image self.image.file fill-600x420-c100 format-webp as webp_img_w_600 %}
{% image self.image.file fill-300x210-c100 format-webp as webp_img_w_300 %}
{% image self.image.file fill-2100x1470-c100 as fallback %}

{% padding self.border self.background as pad %}

<div class="block-container">
  {% if self.format == 'vertical' %}
    <div class="card {{ self.background }} {% if not self.border %}border-0{% endif %} p-{{pad}} h-100">
      <a href="{{ self.link }}" target="_blank">
        <picture>
          <source media="(min-width: 1800px)" srcset="{{ webp_img_w_2100.url }} 2100w" type="image/webp" />
          <source media="(min-width: 120px)" srcset="{{ webp_img_w_1500.url }} 1500w" type="image/webp" />
          <source media="(min-width: 750px)" srcset="{{ webp_img_w_900.url }} 900w" type="image/webp" />
          <source media="(min-width: 500px)" srcset="{{ webp_img_w_600.url }} 600w" type="image/webp" />
          <source srcset="{{ webp_img_w_300.url }} 300w" type="image/webp" />
          <source srcset="{{ fallback.url }} 2100w" />
          <img
            src="{{ fallback.url }}"
            alt="{{ self.image.seo_title }}"
            style="width: 100%; height: auto"
          />
        </picture>
      </a>
      <div class="py-0 text-break">
        {% include_block self.text %}
      </div>
      {% if self.link %}
        <div class="mt-auto pt-2 pb-0 px-0 text-{{ self.link.placement }}">
          <a class="btn stretched-link {{ self.link.appearance }} {{ self.link.size }}" href="{{ self.link.url }}" role="button">{{ self.link.button_text }}</a>
        </div>
      {% endif %}
    </div>
  {% elif self.format == 'image-left-responsive' %}
    <div class="card {{ self.background }} {% if not self.border %}border-0 {% endif %}p-{{pad}} pt-0 {% if self.full_height %}h-100{% endif %}">
      <div class="row">
        <div class="col-md-4 pt-4" style="min-width: 200px;">
          {% if self.link %}<a href="{{ self.link }}">{% endif %}
            <picture>
              <source media="(min-width: 1800px)" srcset="{{ webp_img_w_2100.url }} 2100w" type="image/webp" />
              <source media="(min-width: 120px)" srcset="{{ webp_img_w_1500.url }} 1500w" type="image/webp" />
              <source media="(min-width: 750px)" srcset="{{ webp_img_w_900.url }} 900w" type="image/webp" />
              <source media="(min-width: 500px)" srcset="{{ webp_img_w_600.url }} 600w" type="image/webp" />
              <source srcset="{{ webp_img_w_300.url }} 300w" type="image/webp" />
              <source srcset="{{ fallback.url }} 2100w" />
              <img
                src="{{ fallback.url }}"
                alt="{{ self.image.seo_title }}"
                style="width: 100%; height: auto"
              />
            </picture>
          {% if self.link %}</a>{% endif %}
        </div>
        <div class="col">
          <div class="py-0 text-break">
            {% include_block self.text %}
          </div>
          {% if self.link %}
            <div class="mt-auto p-0 text-end text-sm-{{ self.link.placement }}">
              <a class="btn stretched-link {{ self.link.appearance }} {{ self.link.size }}" href="{{ self.link.url }}" role="button">{{ self.link.button_text }}</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% elif self.format == 'image-left-fixed' %}
    <div class="card {{ self.background }}{% if not self.border %}border-0 {% endif %} p-{{pad}} pt-0 {% if self.full_height %}h-100{% endif %}">
      <div class="row">
        <div class="col-4 pt-4" style="min-width: 200px;">
          <a href="{{ self.link }}">
            <picture>
              <source media="(min-width: 1800px)" srcset="{{ webp_img_w_2100.url }} 2100w" type="image/webp" />
              <source media="(min-width: 120px)" srcset="{{ webp_img_w_1500.url }} 1500w" type="image/webp" />
              <source media="(min-width: 750px)" srcset="{{ webp_img_w_900.url }} 900w" type="image/webp" />
              <source media="(min-width: 500px)" srcset="{{ webp_img_w_600.url }} 600w" type="image/webp" />
              <source srcset="{{ webp_img_w_300.url }} 300w" type="image/webp" />
              <source srcset="{{ fallback.url }} 2100w" />
              <img
                src="{{ fallback.url }}"
                alt="{{ self.image.seo_title }}"
                style="width: 100%; height: auto"
              />
            </picture>
          </a>
        </div>
        <div class="col">
          <div class="p-0 pe-2 text-break">
            {% include_block self.text %}
          </div>
          {% if self.link %}
          <div class="mt-auto p-0 text-{{ self.link.placement }}">
            <a class="btn stretched-link {{ self.link.appearance }} {{ self.link.size }}" href="{{ self.link.url }}" role="button">{{ self.link.button_text }}</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% elif self.format == 'image-right-responsive' %}
    <div class="card {{ self.background }}{% if not self.border %}border-0 {% endif %} p-{{pad}} pt-0 {% if self.full_height %}h-100{% endif %}">
      <div class="row flex-row-reverse">
        <div class="col-md-4 pt-4" style="min-width: 200px;">
          <a href="{{ self.link }}">
            <picture>
              <source media="(min-width: 1800px)" srcset="{{ webp_img_w_2100.url }} 2100w" type="image/webp" />
              <source media="(min-width: 120px)" srcset="{{ webp_img_w_1500.url }} 1500w" type="image/webp" />
              <source media="(min-width: 750px)" srcset="{{ webp_img_w_900.url }} 900w" type="image/webp" />
              <source media="(min-width: 500px)" srcset="{{ webp_img_w_600.url }} 600w" type="image/webp" />
              <source srcset="{{ webp_img_w_300.url }} 300w" type="image/webp" />
              <source srcset="{{ fallback.url }} 2100w" />
              <img
                src="{{ fallback.url }}"
                alt="{{ self.image.seo_title }}"
                style="width: 100%; height: auto"
              />
            </picture>
          </a>
        </div>      
        <div class="col">
          <div class="p-0 text-break">
            {% include_block self.text %}
          </div>
          {% if self.link %}
          <div class="mt-auto p-0 text-end text-sm-{{ self.link.placement }}">
            <a class="btn stretched-link {{ self.link.appearance }} {{ self.link.size }}" href="{{ self.link.url }}" role="button">{{ self.link.button_text }}</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% else %}
    <div class="card {{ self.background }}{% if not self.border %}border-0 {% endif %} p-{{pad}} pt-0 {% if self.full_height %}h-100{% endif %}">
      <div class="row flex-row-reverse">
        <div class="col-4 pt-4" style="min-width: 200px;">
          <a href="{{ self.link }}">
            <picture>
              <source media="(min-width: 1800px)" srcset="{{ webp_img_w_2100.url }} 2100w" type="image/webp" />
              <source media="(min-width: 120px)" srcset="{{ webp_img_w_1500.url }} 1500w" type="image/webp" />
              <source media="(min-width: 750px)" srcset="{{ webp_img_w_900.url }} 900w" type="image/webp" />
              <source media="(min-width: 500px)" srcset="{{ webp_img_w_600.url }} 600w" type="image/webp" />
              <source srcset="{{ webp_img_w_300.url }} 300w" type="image/webp" />
              <source srcset="{{ fallback.url }} 2100w" />
              <img
                src="{{ fallback.url }}"
                alt="{{ self.image.seo_title }}"
                style="width: 100%; height: auto"
              />
            </picture>
          </a>
        </div>      
        <div class="col">
          <div class="p-0 pe-2 text-break">
            {% include_block self.text %}
          </div>
          {% if self.link %}
          <div class="mt-auto p-0 text-{{ self.link.placement }}">
            <a class="btn stretched-link {{ self.link.appearance }} {{ self.link.size }}" href="{{ self.link.url }}" role="button">{{ self.link.button_text }}</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}
</div>
