{% load wagtailcore_tags structured_data_tags core_tags recipe_tags %}
{% get_google_thumbnails self.search_image as thumbnails %}
{% get_social_media_sameas as sameAs %}
{% get_organisation_logo as logo %}
{% wagtail_site as current_site %}
{% autoescape off %}
  <script type="application/ld+json" id="thisArticle">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "mainEntity":{
      "@type": "Recipe",
      "headline": {{ self.get_meta_title|tojson }},
      "name": {{ self.title|tojson }},
      "description": {{ self.description|richtext_to_json }},
      {% if thumbnails %}
      "image": ["{{ thumbnails.tn1x1.full_url }}","{{ thumbnails.tn4x3.full_url }}","{{ thumbnails.tn16x9.full_url }}"],
      {% endif %}
      "datePublished": "{{ self.first_published_at|date:'c' }}",
      "dateModified": "{{ self.last_published_at|date:'c' }}",
      "author": {
          "@type": "Person",
          "name": "{{ self.owner.get_full_name }}",
          "url": "{{ current_site.root_url }}",
          "sameAs": [{{ sameAs }}]
      },
      "publisher": {
          "@type": "Organization",
          "@id": "{{ current_site.root_url }}",
          "name": "{{ current_site.site_name }}",
          "logo": {
            "@type": "ImageObject",
            "url": "{{ logo }}"
          },
          "url": "{{ current_site.root_url }}",
          "sameAs": [{{ sameAs }}]
      },
      "url": "{{ self.full_url }}",
      {% if self.prep_time %}"prepTime": "PT{{ prep_time_hours }}H{{ prep_time_minutes }}M",{% endif %}
      {% if self.cook_time %}"cookTime": "PT{{ cook_time_hours }}H{{ cook_time_minutes }}M",{% endif %}
      {% if self.prep_time or self.cook_time %}"totalTime": "PT{{ total_time_hours }}H{{ total_time_minutes }}M",{% endif %}
      {% if self.recipe_yield %}"recipeYield": {{ self.recipe_yield|tojson }},{% endif %}
      {% if category_tags %}"recipeCategory": {{ category_tags|tojson }},{% endif %}
      {% if cuisine_tags %}"recipeCuisine": {{ cuisine_tags|tojson }},{% endif %}
      {% if keyword_tags %}"keywords": {{ keyword_tags|tojson }},{% endif %}
      "recipeIngredient": {{ page.ingredients|ingredients_to_array }},
      "recipeInstructions": {{ page.instructions|instructions_to_array }},
      "isPartOf": {
          "@type" : "Blog",
          "@id": "{{ self.get_parent.full_url }}",
          "name": {{ self.get_parent.seo_title|tojson }},
          "publisher": {
              "@type": "Organization",
              "@id": "{{ current_site.root_url }}",
              "name": "{{ current_site.site_name }}",
              "logo": {
                "@type": "ImageObject",
                "url": "{{ logo }}"
              },
              "url": "{{ current_site.root_url }}",
              "sameAs": [{{ sameAs }}]
          }
      }
    }
  }
  </script>
{% endautoescape %}
